// ---------- Home ----------
async function renderHome(){
  appContainer.innerHTML = `
  <div class="space-y-4 w-full max-w-xl mx-auto">
    <h2 class="text-2xl font-bold">Daily Entry</h2>

    <!-- Save Today's Entry -->
    <form id="daily-form" class="space-y-2 flex flex-col gap-2">
      <input type="date" name="date" value="${new Date().toISOString().slice(0,10)}" class="input-field" required>
      <input type="number" name="hours" placeholder="Hours studied" min="0" max="24" class="input-field" required>
      <button class="liquid-btn w-full">Save / Add</button>
      <div id="daily-msg" class="text-green-400"></div>
    </form>

    <!-- Update Today's Entry -->
    <h3 class="text-xl font-bold mt-4">Update Entry</h3>
    <form id="update-today-form" class="flex flex-col gap-2">
      <input type="date" name="updateDate" class="input-field" value="${new Date().toISOString().slice(0,10)}" required>
      <input type="number" name="updateHours" placeholder="New hours" min="0" max="24" class="input-field">
      <button class="liquid-btn w-full">Update</button>
      <div id="update-msg" class="text-green-400"></div>
    </form>

    <h2 class="text-2xl font-bold mt-4">Weekly Chart</h2>
    <canvas id="weekly-chart" class="bg-slate-800 rounded p-2"></canvas>
    <h2 class="text-2xl font-bold mt-4">Monthly Chart</h2>
    <canvas id="monthly-chart" class="bg-slate-800 rounded p-2"></canvas>
  </div>`;

  // ---------- Add / Save Entry ----------
  document.getElementById('daily-form').onsubmit = async e=>{
    e.preventDefault();
    const f = e.target;
    const today = f.date.value;
    if(Number(f.hours.value) > 24){ alert("Maximum hours per day is 24"); return; }

    const logsSnap = await getDocs(query(collection(db,'studyLogs'), where('userId','==',currentUser.uid), where('date','==',today)));
    if(logsSnap.docs.length){
      const docId = logsSnap.docs[0].id;
      await updateDoc(doc(db,'studyLogs',docId), {hours: Number(f.hours.value)});
      document.getElementById('daily-msg').textContent = 'Updated!';
    } else {
      await addDoc(collection(db,'studyLogs'), {userId: currentUser.uid, date: today, hours: Number(f.hours.value), createdAt:new Date().toISOString()});
      document.getElementById('daily-msg').textContent = 'Saved!';
    }
    renderCharts();
  };

  // ---------- Update Entry ----------
  document.getElementById('update-today-form').onsubmit = async e=>{
    e.preventDefault();
    const f = e.target;
    const today = f.updateDate.value; // <-- user-selected date
    const newHours = Number(f.updateHours.value);
    if(newHours > 24){ alert("Maximum hours per day is 24"); return; }

    const logsSnap = await getDocs(query(collection(db,'studyLogs'), where('userId','==',currentUser.uid), where('date','==',today)));
    if(logsSnap.docs.length){
      const docId = logsSnap.docs[0].id;
      await updateDoc(doc(db,'studyLogs',docId), {hours: newHours});
      document.getElementById('update-msg').textContent = `Entry for ${today} updated!`;
      f.updateHours.value = '';
    } else {
      alert(`No entry for ${today}. Please add it first.`);
    }
    renderCharts();
  };

  // ---------- Render Charts ----------
  renderCharts();
}
