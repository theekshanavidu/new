<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="https://img.freepik.com/free-photo/billie-dollar-money-background_1150-744.jpg">
<title>Senul Seettu Random Number</title>

<style>
body {
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  margin: 0;
  padding: 20px;
  background: url('https://cdn.shopify.com/s/files/1/1279/9999/files/CasinoSupply-319669-roulette-table-players-image-a1.jpg?v=1724267235') no-repeat center center fixed;
  background-size: cover;
  position: relative;
}
body::before {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(255,255,255,0.7);
  z-index: 0;
}
* { position: relative; z-index: 1; }
h1 { color:#333; }

.card-container {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  max-width:700px;
  margin-top:20px;
}

.card {
  width:100px;
  height:140px;
  background:#fff;
  border-radius:10px;
  margin:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:30px;
  cursor:pointer;
  transition: transform 0.5s, background 0.5s;
  box-shadow:0 4px 8px rgba(0,0,0,0.2);
}

.flipped {
  background:#4CAF50;
  color:white;
}

.admin-panel {
  display:none;
  flex-direction:column;
  align-items:center;
  background:#f9f9f9;
  padding:20px;
  border-radius:10px;
  box-shadow:0 4px 8px rgba(0,0,0,0.2);
  margin-top:20px;
}

input {
  padding:10px;
  border:none;
  border-radius:5px;
  margin:5px;
  width:200px;
}

button {
  padding:10px 20px;
  border:none;
  border-radius:5px;
  margin:5px;
  background: linear-gradient(90deg,#4CAF50 50%, #2e7d32 50%);
  background-size:200% 100%;
  color:white;
  cursor:pointer;
  transition: all 0.4s ease;
  font-weight:bold;
}

button:hover {
  background-position: right center;
}

#footer { margin-top:30px; color:gray; }
</style>
</head>

<body>

<h1>ğŸ° Senul Seettu Random Number ğŸ¯</h1>

<div id="name-section">
  <input type="text" id="username" placeholder="Enter Your Full Name">
  <button id="startBtn">Start</button>
</div>

<div class="card-container" id="cards" style="display:none;"></div>

<div id="login-section">
  <input type="password" id="adminPass" placeholder="Admin Password">
  <button id="loginBtn">Admin Login</button>
</div>

<div class="admin-panel" id="adminPanel">
  <h2>ğŸ§‘â€ğŸ’¼ Admin Panel</h2>

  <label>Total Players:
    <input type="number" id="totalPlayers" min="2" value="10">
  </label>
  <button id="setPlayersBtn">Set Players</button>

  <h3>Assign Number Manually</h3>
  <input type="text" id="manualName" placeholder="Player Name">
  <input type="number" id="manualNumber" placeholder="Number">
  <button id="assignBtn">Assign</button>

  <h3>Assigned Numbers</h3>
  <div id="results"></div>

  <button id="resetBtn">ğŸ”„ Reset All</button>
  <button id="exportBtn">ğŸ“¥ Export as PNG</button>
</div>

<div id="footer">Â© Theekshana Viduranga</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<audio id="cardClickSound" src="https://assets.mixkit.co/sfx/preview/mixkit-game-click-1114.mp3"></audio>
<audio id="numberRevealSound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-notification-2018.mp3"></audio>

<script>
// Firebase config
firebase.initializeApp({
  apiKey: "AIzaSyACPs6N80C3i8SS3aG7ahybThWvsPSf19o",
  authDomain: "senul-80301.firebaseapp.com",
  databaseURL: "https://senul-80301-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "senul-80301",
  storageBucket: "senul-80301.appspot.com",
  messagingSenderId: "718343352275",
  appId: "1:718343352275:web:7c0e22dd69981690df8926"
});

const db = firebase.database();

let totalPlayers = 10;
let assigned = [];
let availableNumbers = [];

const cardsContainer = document.getElementById("cards");
const results = document.getElementById("results");

db.ref("totalPlayers").on("value", s => {
  if (s.val()) totalPlayers = s.val();
});

db.ref("assigned").on("value", s => {
  assigned = s.val() || [];
  updateAvailableNumbers();
  displayResults();
});

function updateAvailableNumbers(){
  availableNumbers = [];
  for(let i=2;i<=totalPlayers;i++){
    if(!assigned.find(a => a.number === i)){
      availableNumbers.push(i);
    }
  }
}

function displayResults(){
  results.innerHTML = assigned.length
    ? assigned.map(a => `<p>${a.name} â†’ ${a.number}</p>`).join("")
    : "<p>No numbers assigned</p>";
}

function generateCards(username){
  cardsContainer.innerHTML = "";
  for(let i=0;i<totalPlayers-1;i++){
    const card = document.createElement("div");
    card.className = "card";
    card.innerText = "â“";

    card.onclick = () => {

      if(assigned.find(a => a.name === username)){
        return alert("You already received a number!");
      }

      if(availableNumbers.length === 0){
        return alert("No numbers available!");
      }

      document.getElementById("cardClickSound").play();

      const num = availableNumbers[Math.floor(Math.random()*availableNumbers.length)];
      assigned.push({ name: username, number: num, adminAssigned:false });
      db.ref("assigned").set(assigned);

      card.classList.add("flipped");
      card.innerText = num;
      document.getElementById("numberRevealSound").play();

      alert(`${username} got number ${num}`);
    };

    cardsContainer.appendChild(card);
  }
}

document.getElementById("startBtn").onclick = () => {
  const name = username.value.trim();
  if(!name) return alert("Enter your name!");
  document.getElementById("name-section").style.display="none";
  cardsContainer.style.display="flex";
  generateCards(name);
};

document.getElementById("loginBtn").onclick = () => {
  if(adminPass.value === "pacaya123"){
    document.getElementById("login-section").style.display="none";
    adminPanel.style.display="flex";
  } else alert("Wrong password!");
};

document.getElementById("setPlayersBtn").onclick = () => {
  const v = parseInt(totalPlayers.value);
  if(v < 2) return alert("Min 2 players!");
  db.ref("totalPlayers").set(v);
};

document.getElementById("assignBtn").onclick = () => {
  const name = manualName.value.trim();
  const num = parseInt(manualNumber.value);

  if(!name || !num) return alert("Name & number required!");
  if(num < 2 || num > totalPlayers) return alert("Invalid number!");

  if(assigned.find(a => a.name === name))
    return alert("This player already has a number!");

  if(assigned.find(a => a.number === num))
    return alert("This number already assigned!");

  assigned.push({ name, number:num, adminAssigned:true });
  db.ref("assigned").set(assigned);
};

document.getElementById("resetBtn").onclick = () => {
  if(confirm("Reset all?")){
    db.ref("assigned").set([]);
    db.ref("totalPlayers").set(10);
    location.reload();
  }
};

document.getElementById("exportBtn").onclick = () => {
  html2canvas(results).then(c => {
    const a = document.createElement("a");
    a.download = "assigned_numbers.png";
    a.href = c.toDataURL();
    a.click();
  });
};
</script>

</body>
</html>
